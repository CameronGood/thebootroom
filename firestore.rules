rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Boots: public read, admin write only
    match /boots/{bootId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }

    // Users: read/write own document only
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Quiz Sessions: create allowed, read/write if owner or no userId
    match /quizSessions/{sessionId} {
      allow create: if true;
      allow read, write: if request.auth == null || 
        request.auth.uid == resource.data.userId || 
        !('userId' in resource.data);
    }

    // Affiliate Clicks: read admin only, write via server/API only (not directly from client)
    match /affiliateClicks/{clickId} {
      allow read: if request.auth != null && request.auth.token.admin == true;
      allow write: if false; // Only via server/API
    }

    // Fitting Breakdowns: read/write own document only
    match /fittingBreakdowns/{docId} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
    }

    // Billing Metrics: read admin only, write via server/API only
    match /billingMetrics/{month} {
      allow read: if request.auth != null && request.auth.token.admin == true;
      allow write: if false; // Only via server/API
    }
  }
}

